<!DOCTYPE html>
<html lang="en">
  <head>
    <style type="text/css" media="print">
      @page {
        size: auto;
        margin: 10mm;
      }
      body {
        padding: 10px 0;
        font-family: Arial, Helvetica, sans-serif;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        font-size: 9px !important;
        page-break-inside: avoid !important;
      }
      table td {
        padding: .25rem;
        line-height: 1.2;
      }
      .center {
        text-align: center;
      }
      .titulo_principal {
        margin-top: 10px;
        margin-bottom: 10px;
      }
      .titulo {
        margin: 0;
      }
      .deuda {
        color: #F44336;
      }
      #pageFooter {
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h6 class="titulo" style="text-align: left;">
      Reporte emitido el día <%= fechaEmision %>
    </h6>
    <h5 class="titulo_principal" style="text-align: center;">
      <%= title %>
    </h5>

    <!--ENCABEZADO-->
    <table width="100%">
      <tr>
        <td width="50%" style="padding-right: 2rem;">          
          <!--TOTAL VENCIDO-->
          <table style="width: 200px; margin-left: auto;" border="1">
            <thead>
              <tr>
                <td colspan="2" style="text-align: center;">
                  <b>Total Vencido</b>
                </td>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < totalvencido_array.length; i++) { %>
                <tr>
                  <td width="50%" style="text-align: center;">
                    <%= totalvencido_array[i][0] ? totalvencido_array[i][0] + ' días' : '' %>
                  </td>
                  <td width="50%" style="text-align: right;">
                    <%= totalvencido_array[i][1] ? '$' + totalvencido_array[i][1] : '$0.00' %>
                  </td>
                </tr>
              <% } %>
            </tbody>
            <tfoot>
              <tr>
                <td width="50%" style="text-align: center; border-right: 0;">
                  <b>TOTAL</b>
                </td>
                <td width="50%" style="text-align: right; border-left: 0;">
                  <b><%= totalvencido ? '$' + totalvencido : '$0.00' %></b>
                </td>
              </tr>
            </tfoot>
          </table>
        </td>
        <td width="50%" style="padding-left: 2rem;">
          <!--TOTAL POR VENCER-->
          <table style="width: 200px; margin-right: auto;" border="1">
            <thead>
              <tr>
                <td colspan="2" style="text-align: center;">
                  <b>Total Por Vencer</b>
                </td>
              </tr>
            </thead>
            <tbody>
              <% for (let i = 0; i < totalxvencer_array.length; i++) { %>
                <tr>
                  <td width="50%" style="text-align: center;">
                    <%= totalxvencer_array[i][0] ? totalxvencer_array[i][0] + ' días' : '' %>
                  </td>
                  <td width="50%" style="text-align: right;">
                    <%= totalxvencer_array[i][1] ? '$' + totalxvencer_array[i][1] : '$0.00' %>
                  </td>
                </tr>
              <% } %>
            </tbody>
            <tfoot>
              <tr>
                <td width="50%" style="text-align: center; border-right: 0;">
                  <b>TOTAL</b>
                </td>
                <td width="50%" style="text-align: right; border-left: 0;">
                  <b><%= totalxvencer ? '$' + totalxvencer : '$0.00' %></b>
                </td>
              </tr>
            </tfoot>
          </table>
        </td>
      </tr>
    </table>

    <br/>
    <!--CUERPO-->
    <% if (formato == 1) { %>
      <table width="100%" border="1">
        <thead>
          <tr>
            <td width="7%" style="text-align: center;"><b>Tipo</b></td>
            <td width="10%" style="text-align: center;"><b>Factura/Expediente</b></td>
            <td width="10%" style="text-align: center;"><b>Correlativo Factura</b></td>
            <td width="23%" style="text-align: center;"><b>Proveedor</b></td>
            <td width="9%" style="text-align: center;"><b>F. Disponibilidad</b></td>
            <td width="4%" style="text-align: center;"><b>Moneda</b></td>
            <td width="6%" style="text-align: center;"><b>Total Pagar</b></td>
            <td width="7%" style="text-align: center;"><b>F. Vencimiento</b></td>
            <td width="6%" style="text-align: center;"><b>Días Atraso</b></td>
            <td width="5%" style="text-align: center;"><b>Pagado Cliente</b></td>
            <td width="6%" style="text-align: center;"><b>Llegada</b></td>
            <td width="7%" style="text-align: center;"><b>Estatus</b></td>
          </tr>
        </thead>
        <tbody>
          <% for (let i = 0; i < data.length; i++) { %>
            <tr>
              <td style="text-align: center;">
                <%= data[i].esoperativo ? 'OPERATIVO' : data[i].esadministrativo ? 'ADMINISTRATIVO' : '' %>
              </td>
              <td><%= data[i].factura && data[i].expediente ? data[i].factura + ' - ' + data[i].expediente : data[i].factura || data[i].expediente %></td>
              <td><%= data[i].correlativo %></td>
              <td><%= data[i].proveedor %></td>
              <td style="text-align: center;"><%= data[i].fecha_disponibilidad %></td>
              <td style="text-align: center;"><%= data[i].symbol %></td>
              <td style="text-align: right;"><%= data[i].total_pagar %></td>
              <td style="text-align: center;"><%= data[i].fechavencimiento  %></td>              
              <td style="text-align: right;"><%= data[i].diasatraso %></td>
              <td style="text-align: right;"><%= data[i].pagado %></td>
              <td style="text-align: right;"><%= data[i].llegada %></td>
              <td><%= data[i].estatus %></td>
            </tr>
          <% } %>
        </tbody>
      </table>
    <% } else if (formato == 2) { %>
      <% for (let i = 0; i < data.length; i++) { %>
        <table width="100%" border="1">
          <thead>
            <tr>
              <td style="text-align: center;" colspan="2"></td>
              <td style="text-align: center;" colspan="6"><b>Vencidas</b></td>
              <td style="text-align: center;" colspan="6"><b>Por Vencer</b></td>
            </tr>
            <tr>
              <td width="18%" style="text-align: center;"><b>Proveedor</b></td>
              <td width="10%" style="text-align: center;"><b>Factura/Expediente</b></td>

              <td width="6%" style="text-align: center;"><b>+60 días</b></td>
              <td width="6%" style="text-align: center;"><b>+45 días</b></td>
              <td width="6%" style="text-align: center;"><b>+30 días</b></td>
              <td width="6%" style="text-align: center;"><b>+15 días</b></td>
              <td width="6%" style="text-align: center;"><b>+7 días</b></td>
              <td width="6%" style="text-align: center;"><b>+0 días</b></td>

              <td width="6%" style="text-align: center;"><b>-7 días</b></td>
              <td width="6%" style="text-align: center;"><b>-15 días</b></td>
              <td width="6%" style="text-align: center;"><b>-30 días</b></td>
              <td width="6%" style="text-align: center;"><b>-45 días</b></td>
              <td width="6%" style="text-align: center;"><b>-60 días</b></td>
              <td width="6%" style="text-align: center;"><b>+60 días</b></td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center;" rowspan="<%= data[i].expedientes.length %>">
                <p class="titulo"><b><%= data[i].proveedor %></b></p>
                <p class="titulo">Días de Crédito: <b><%= data[i].dias_credito ? data[i].dias_credito + ' días' : 'NO TIENE'  %></b></p>
              </td>
              <td>
                <%= 
                  data[i].expedientes[0].factura && data[i].expedientes[0].expediente 
                    ? data[i].expedientes[0].factura + ' - ' + data[i].expedientes[0].expediente 
                    : data[i].expedientes[0].factura || data[i].expedientes[0].expediente 
                %>
              </td>

              <% if (data[i].expedientes[0].vencido) { %>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+60"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+60"] + '</span>' : '-' %></td>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+45"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+45"] + '</span>' : '-' %></td>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+30"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+30"] + '</span>' : '-' %></td>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+15"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+15"] + '</span>' : '-' %></td>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+7"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+7"] + '</span>' : '-' %></td>
                <td style="text-align: right;"><%- data[i].expedientes[0].vencido["+0"] ? '<span class="deuda">$' + data[i].expedientes[0].vencido["+0"] + '</span>' : '-' %></td>
              <% } else { %>
                <td colspan="6"></td>
              <% } %>

              <% if (data[i].expedientes[0].xvencer) { %>               
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["-7"] ? '$' + data[i].expedientes[0].xvencer["-7"] : '-' %></td>
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["-15"] ? '$' + data[i].expedientes[0].xvencer["-15"] : '-' %></td>
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["-30"] ? '$' + data[i].expedientes[0].xvencer["-30"] : '-' %></td>
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["-45"] ? '$' + data[i].expedientes[0].xvencer["-45"] : '-' %></td>
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["-60"] ? '$' + data[i].expedientes[0].xvencer["-60"] : '-' %></td>
                <td style="text-align: right;"><%= data[i].expedientes[0].xvencer["+60"] ? '$' + data[i].expedientes[0].xvencer["+60"] : '-' %></td>
              <% } else { %>
                <td colspan="6"></td>
              <% } %>
            </tr>
              <% for (let j = 1; j < data[i].expedientes.length; j++) { %>
                <tr>
                  <td>
                    <%= 
                      data[i].expedientes[j].factura && data[i].expedientes[j].expediente 
                        ? data[i].expedientes[j].factura + ' - ' + data[i].expedientes[j].expediente 
                        : data[i].expedientes[j].factura || data[i].expedientes[j].expediente 
                    %>
                  </td>

                  <% if (data[i].expedientes[j].vencido) { %>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+60"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+60"] + '</span>' : '-' %></td>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+45"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+45"] + '</span>' : '-' %></td>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+30"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+30"] + '</span>' : '-' %></td>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+15"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+15"] + '</span>' : '-' %></td>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+7"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+7"] + '</span>' : '-' %></td>
                    <td style="text-align: right;"><%- data[i].expedientes[j].vencido["+0"] ? '<span class="deuda">$' + data[i].expedientes[j].vencido["+0"] + '</span>' : '-' %></td>
                  <% } else { %>
                    <td colspan="6">-</td>
                  <% } %>
                  
                  <% if (data[i].expedientes[j].xvencer) { %>               
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["-7"] ? '$' + data[i].expedientes[j].xvencer["-7"] : '-' %></td>
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["-15"] ? '$' + data[i].expedientes[j].xvencer["-15"] : '-' %></td>
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["-30"] ? '$' + data[i].expedientes[j].xvencer["-30"] : '-' %></td>
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["-45"] ? '$' + data[i].expedientes[j].xvencer["-45"] : '-' %></td>
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["-60"] ? '$' + data[i].expedientes[j].xvencer["-60"] : '-' %></td>
                    <td style="text-align: right;"><%= data[i].expedientes[j].xvencer["+60"] ? '$' + data[i].expedientes[j].xvencer["+60"] : '-' %></td>
                  <% } else { %>
                    <td colspan="6"></td>
                  <% } %>
                </tr>
              <% } %>
          </tbody>
          <tfoot>
            <tr>
              <td style="text-align: right; border-right: 0;" colspan="6"><b>TOTAL VENCIDAS</b></td>
              <td style="text-align: right; border-left: 0; border-right: 0;" colspan="2">
                <%- data[i].totalvencido ? '<span class="deuda"><b>$' + data[i].totalvencido + '</b></span>' : '-' %>
              </td>
  
              <td style="text-align: right; border-right: 0; border-left: 0;" colspan="4"><b>TOTAL POR VENCER</b></td>
              <td style="text-align: right; border-left: 0;" colspan="2">
                <%- data[i].totalxvencer ? '<b>$' + data[i].totalxvencer + '</b>' : '-' %>
              </td>
            </tr>
          </tfoot>          
        </table>

        <br/>
      <% } %>
    <% } %>

    <div id="pageFooter">Default footer</div>
  </body>
</html>
