<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div style="text-align: center">
      <h1 class="title">REPORTE DE QUOTE GENERAL - MARKETEO</h1>
      <h3 class="subtitle"><%=sucursal %></h3>
    </div>

    <!-- Primera Sección: Total por Marketing y Resumen -->
    <div class="container">
      <div class="item">
        <h3>TOTAL POR MARKETING:</h3>
        <table style="width: 100%;">
          <thead>
            <tr>
              <th class="headerDetalle">Marketing</th>
              <th class="headerDetalle">Cantidad</th>
            </tr>
          </thead>
          <tbody>
            <% 
            let totalMarketing = 0;
            if (countByActivosArray && countByActivosArray.length > 0) {
              countByActivosArray.forEach(mkt => {
                totalMarketing += mkt.cantidad;
            %>
            <tr>
              <td><%= mkt.name %></td>
              <td style="text-align: center;"><%= mkt.cantidad %></td>
            </tr>
            <%});%>
            <!-- Fila de Total -->
            <tr style="background-color: #f0f0f0; font-weight: bold;">
              <td><strong>TOTAL</strong></td>
              <td style="text-align: center;"><strong><%= totalMarketing %></strong></td>
            </tr>
            <%}%>
          </tbody>
        </table>
      </div>
      <div class="item">
        <h3>RESUMEN GENERAL:</h3>
        <table style="width: 100%;">
          <tbody>
            <tr>
              <td><strong>Total de Cotizaciones:</strong></td>
              <td style="text-align: right;"><strong><%= totalGeneral %></strong></td>
            </tr>
            <tr>
              <td><strong>Monto Total General:</strong></td>
              <td style="text-align: right;"><strong>$<%= montoTotalGeneral.toFixed(2) %></strong></td>
            </tr>
            <tr>
              <td><strong>Total de Clientes:</strong></td>
              <td style="text-align: right;"><strong><%= countByClientArray.length %></strong></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Segunda Sección: Total por Cliente -->
    <div class="container">
      <div class="item" style="width: 100% !important;">
        <h3>TOTAL POR CLIENTE:</h3>
        <table style="width: 100%;">
          <thead>
            <tr>
              <th class="headerDetalle">Cliente</th>
              <th class="headerDetalle">Cantidad</th>
              <th class="headerDetalle">Monto Total</th>
            </tr>
          </thead>
          <tbody>
            <% 
            let totalCantidadClientes = 0;
            let totalMontoClientes = 0;
            if (countByClientArray && countByClientArray.length > 0) {
              countByClientArray.forEach(element => {
                totalCantidadClientes += element.cantidad;
                totalMontoClientes += element.monto_total;
            %>
            <tr>
              <td><%= element.nombre %></td>
              <td style="text-align: center;"><%= element.cantidad %></td>
              <td style="text-align: right;">$<%= element.monto_total.toFixed(2) %></td>
            </tr>
            <%});%>
            <!-- Fila de Total -->
            <tr style="background-color: #f0f0f0; font-weight: bold;">
              <td><strong>TOTAL</strong></td>
              <td style="text-align: center;"><strong><%= totalCantidadClientes %></strong></td>
              <td style="text-align: right;"><strong>$<%= totalMontoClientes.toFixed(2) %></strong></td>
            </tr>
            <%} else {%>
            <tr>
              <td colspan="3" style="text-align: center;">No hay datos de clientes</td>
            </tr>
            <%}%>
          </tbody>
        </table>
      </div>
    </div>

    <table style="width: 100% !important">
      <thead>
        <tr>
          <th class="headerDetalle">FECHA</th>
          <th class="headerDetalle">MARKETING</th>
          <th class="headerDetalle">CÓD</th>
          <th class="headerDetalle">CLIENTE</th>
          <th class="headerDetalle">TELÉFONO</th>
          <th class="headerDetalle">SENTIDO</th>
          <th class="headerDetalle">TIPO CARGA</th>
          <th class="headerDetalle">CCI</th>
          <th class="headerDetalle">ORIGEN</th>
          <th class="headerDetalle">DESTINO</th>
          <th class="headerDetalle">VENDEDOR</th>
          <th class="headerDetalle">ESTATUS</th>
        </tr>
      </thead>
      <tbody>
        <%if (lstmarketing.length>0) {%> <% lstmarketing.forEach(element => {%>
        <tr>
          <td class="center"><%=element.created%></td>
          <td class="center"><%=element.namemarketing%></td>
          <td class="center"><%=element.codigo%></td>
          <td><%=element.nombres%></td>
          <td class="center"><%=element.telefono%></td>
          <td class="center"><%=element.sentido%></td>
          <td class="center"><%=element.tipo_de_carga%></td>
          <td class="center"><%=element.incoterms%></td>
          <td class="center"><%=element.origen%></td>
          <td class="center"><%=element.destino%></td>
          <td class="center"><%=element.ejecutivo_ventas%></td>
          <td class="center"><%=element.status%></td>
        </tr>
        <%});%> <%}%>
      </tbody>
    </table>
  </body>
</html>

<style>
  * {
    font-size: 0.7rem !important;
  }

  .container {
    width: 100%;
    display: block;
  }

  .half {
    width: 50%;
    box-sizing: border-box;
    padding: 10px;
    border: 1px solid #000;
    display: inline-block;
    vertical-align: top; /* Alinea los elementos en la parte superior */
  }
  .headerDetalle {
    background: rgb(58, 17, 0);
    color: white;
  }
  .container {
    display: flex;
    width: 100%;
    margin: 1cm 0 2cm 0;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .item {
    float: left !important;
    width: 50% !important ;
  }
  .title {
    font-size: 1.5rem !important;
  }
  .subtitle {
    font-size: 1.2rem !important;
  }
  td,
  th {
    text-align: center;
    vertical-align: center;
    border-spacing: 0;
  }

  td {
    text-align: left;
  }
  .td {
    max-width: 100%;
    white-space: nowrap;
  }
  .center {
    text-align: center;
  }
</style>
